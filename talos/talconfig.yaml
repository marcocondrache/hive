---
clusterName: &clusterName hive

endpoint: https://192.168.0.51:6443

talosVersion: v1.10.0-beta.1
kubernetesVersion: v1.33.0-rc.1

clusterPodNets:
  - "10.42.0.0/16"

clusterSvcNets:
  - "10.43.0.0/16"

additionalApiServerCertSans: &sans
  - 192.168.0.51
  - 127.0.0.1

additionalMachineCertSans: *sans

cniConfig:
  name: none

nodes:
  - hostname: 192.168.0.51 # queen leadership
    ipAddress: 192.168.0.51
    installDisk: /dev/mmcblk0 # eMMC
    controlPlane: true

    machineSpec: &turingrk1-machineSpec
      mode: metal
      arch: arm64
      secureboot: false
      useUKI: false
      bootMethod: disk-image
      imageSuffix: raw.xz

    # Enable when talhelper is released
    # userVolumes:
    #   - name: DATA
    #     provisioning:
    #       diskSelector:
    #         match: disk.transport == "nvme"
    #       grow: true

    volumes:
      - name: EPHEMERAL
        provisioning:
          diskSelector:
            match: disk.transport == "nvme"
          maxSize: 100GiB

    networkInterfaces:
      - interface: end0
        dhcp: true

    schematic: &turingrk1-schematic
      overlay:
        name: turingrk1
        image: siderolabs/sbc-rockchip
      customization:
        systemExtensions:
          officialExtensions:
            - siderolabs/iscsi-tools

  # missing hardware
  # - hostname: royal-jelly.hive.internal # sustenance
  #   ipAddress: 192.168.0.52
  #   controlPlane: true
  #   installDisk: /dev/mmcblk0 # eMMC
  #   networkInterfaces:
  #     - interface: end0
  #       dhcp: true
  #       vip:
  #         ip: *vip

  # missing hardware
  # - hostname: royal-guard.hive.internal # protection
  #   ipAddress: 192.168.0.53
  #   controlPlane: true
  #   installDisk: /dev/mmcblk0 # eMMC
  #   networkInterfaces:
  #     - interface: end0
  #       dhcp: true
  #       vip:
  #         ip: *vip

  # missing hardware
  # - hostname: forager.hive.internal
  #   ipAddress: 192.168.0.59
  #   installDisk: /dev/mmcblk0 # eMMC
  #   networkInterfaces:
  #     - interface: end0
  #       dhcp: true

patches:
  - "@./patches/common/machine-files.yaml"
  - "@./patches/common/machine-kubelet.yaml"
  - "@./patches/common/machine-network.yaml"
  - "@./patches/common/machine-features.yaml"

controlPlane:
  nodeLabels: &nodeLabels
    topology.kubernetes.io/region: *clusterName
    topology.kubernetes.io/zone: m

  patches:
    - "@./patches/controlplane/cluster.yaml"
    - "@./patches/controlplane/machine-features.yaml"

  # TODO: Remove this once talhelper is released
  extraManifests:
    - /Users/marcocondrache/Personal/hive/talos/manifests/data-volume.yaml
